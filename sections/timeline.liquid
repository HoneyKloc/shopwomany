{% style %}

.timeline-section{
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
}
{% endstyle %}
<div class="section timeline-section">
    <div class="timeline-wrapper">
        <div class="items">
            {% for block in section.blocks %}
            <div class="item item-{{ forloop.index }}">
                <div class="content">
                    {% if block.settings.heading != blank %}
                        <h2 class="heading">{{ block.settings.heading }}</h2>
                    {% endif %}
                    {% if block.settings.content != blank %}
                        <div class="text">{{ block.settings.content }}</div>
                    {% endif %}
                </div>
                <div class="image-slider">
                    {% if block.settings.image_1 != blank %}
                    <div class="image">
                        {{ block.settings.image_1 | image_url: width: 893 | image_tag: loading: 'lazy'  }}
                    </div>
                    {% endif %}
                    {% if block.settings.image_2 != blank %}
                    <div class="image">
                        {{ block.settings.image_2 | image_url: width: 893 | image_tag: loading: 'lazy'  }}
                    </div>
                    {% endif %}
                    {% if block.settings.image_3 != blank %}
                    <div class="image">
                        {{ block.settings.image_3 | image_url: width: 893 | image_tag: loading: 'lazy'  }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="timeline-steps">
            <ul>
            {% for block in section.blocks %}
                <li class="step step-{{ forloop.index }}">{{ block.settings.label }}</li>
            {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% schema %}
{
    "name": "Timeline",
    "tag": "section",
    "class": "timeline-section",
    "settings": [
        {
            "type": "header",
            "content": "Section Properties"
        },
        {
            "type": "text",
            "id": "custom_class",
            "label": "Class"
        },
        {
            "type":"range",
            "id": "padding_top",
            "label": "Padding top",
            "min": 0,
            "max": 100,
            "step": 2,
            "unit": "px",
            "default": 30
        },
        {
            "type":"range",
            "id": "padding_bottom",
            "label": "Padding bottom",
            "min": 0,
            "max": 100,
            "step": 2,
            "unit": "px",
            "default": 30
        },
    ],
    "blocks": [
        {
            "type": "tab",
            "name": "Tab",
            "settings": [
                {
                    "type": "text",
                    "id": "label",
                    "label": "Label"
                },
                {
                    "type": "text",
                    "id": "heading",
                    "label": "Heading"
                },
                {
                    "type": "richtext",
                    "id": "content",
                    "label": "Content"
                },
                {
                    "type": "color",
                    "id": "background_color",
                    "label": "Background color"
                },
                {
                    "type": "image_picker",
                    "id": "image_1",
                    "label": "Image 1"
                },
                {
                    "type": "image_picker",
                    "id": "image_2",
                    "label": "Image 2"
                },
                {
                    "type": "image_picker",
                    "id": "image_3",
                    "label": "Image 3"
                }
            ]
        }
    ],
    "presets": [
        {
            "name": "Timeline"
        }
    ]

}
{% endschema %}

{% javascript %}
    document.addEventListener("DOMContentLoaded", () => {
    const items = document.querySelectorAll(".timeline-wrapper .item");
    const steps = document.querySelectorAll(".timeline-steps li");

    function showItem(index) {
        items.forEach((item, i) => {
        item.classList.toggle("active", i === index);
        item.style.display = i === index ? "flex" : "none";
        });
        steps.forEach((step, i) => {
        step.classList.toggle("active", i === index);
        });
    }

    showItem(0); // show first item

    steps.forEach((step, index) => {
        step.addEventListener("click", () => showItem(index));
    });
    });


document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".image-slider").forEach(slider => {
    const images = slider.querySelectorAll(".image");
    const total = images.length;
    let index = 0;
    const intervalTime = 3000;
    let timer, startTime, animationFrame;

    // Create progress segments
    const barWrapper = document.createElement("div");
    barWrapper.className = "progress-bar-wrapper";
    const segments = [];

    for(let i=0;i<total;i++){
      const seg = document.createElement("div");
      seg.className = "progress-segment";
      const fill = document.createElement("div");
      fill.className = "progress-fill";
      seg.appendChild(fill);
      barWrapper.appendChild(seg);
      segments.push({seg, fill});

      // Click to jump
      seg.addEventListener("click", () => {
        index = i;
        showImage(index);
        resetTimer();
      });
    }
    slider.appendChild(barWrapper);

    function showImage(i){
      images.forEach((img, idx) => img.classList.toggle("active", idx===i));
      segments.forEach((s, idx)=>{
        s.fill.style.width = idx < i ? "100%" : "0%";
      });
      startTime = performance.now();
    }

    function animateBar(time){
      const elapsed = time - startTime;
      const percent = Math.min(elapsed / intervalTime * 100, 100);
      segments[index].fill.style.width = percent + "%";
      animationFrame = requestAnimationFrame(animateBar);
    }

    function next(){
      index = (index+1)%total;
      showImage(index);
    }

    function resetTimer(){
      clearInterval(timer);
      cancelAnimationFrame(animationFrame);
      startTime = performance.now();
      timer = setInterval(next, intervalTime);
      animationFrame = requestAnimationFrame(animateBar);
    }

    showImage(index);
    timer = setInterval(next, intervalTime);
    animationFrame = requestAnimationFrame(animateBar);
  });
});

{% endjavascript %}